@page "/managemycasework/overview/"
@model DfE.FindInformationAcademiesTrusts.Pages.ManageMyCasework.Overview.IndexModel
@{
    Layout = "_MMCLayout";
    ViewData["Title"] = "Manage my casework";

    // string PageOrPages()
    // {
    //     if (Model.Pagination.TotalPages == 1)
    //     {
    //         return "page";
    //     }
    //     return "pages";
    // }
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        @if (Model.Filters.IsVisible) 
        { 
            <div class="govuk-notification-banner govuk-notification-banner--success" role="alert" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner" data-cy="filter-success-notification"> 
                <div class="govuk-notification-banner__header"> 
                    <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title"> 
                        Success 
                    </h2> 
                </div> 
                <div class="govuk-notification-banner__content"> 
                    <h3 class="govuk-notification-banner__heading"> 
                        Filters applied 
                    </h3> 
                    <p class="govuk-body"> 
                        @* @Model.TotalProjects schools found on @Model.Pagination.TotalPages @PageOrPages() of results  *@
                    </p> 
                </div> 
            </div> 
        } 
    </div>
    <div class="govuk-grid-column-one-third">
        <partial name="Shared/_ProjectListFilters" model="Model.Filters" />
    </div>
    <div class="govuk-grid-column-two-thirds">

        <h2 class="govuk-heading-l" test-id="projectCount" data-cy="select-projectlist-filter-count">@Model.Cases.PageStatus.TotalResults projects found</h2>
        <div class="govuk-form-group">
            <label class="govuk-label--m" for="sort">
                Sort by: 
            </label>
            
            <form id="sortForm" method="get" class="form">
                <select class="govuk-select" id="sorting" asp-for="@Model.Sorting">
                    <option value="@ResultSorting.createdDesc">Most recently created</option>
                    <option value="@ResultSorting.createdAsc">Least recently created</option>
                    <option value="@ResultSorting.updatedDesc">Most recently updated</option>
                    <option value="@ResultSorting.updatedAsc">Least recently updated</option>
                </select>
            </form>
        </div>
        <table class="govuk-table">
            @*          <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th class="govuk-table__header app-!-width-three-fifths">School information</th>
                </tr>
            </thead> *@
            <tbody class="govuk-table__body">
                
                
                @{
                    var index = 0;

                    if (Model.Cases != null)
                    {
                        foreach (var currentCase in Model.Cases)
                        {
                            <tr class="govuk-table__row" data-cy="select-caselist-filter-row">
                                <td class="govuk-table__cell">
                                    <div class="govuk-!-margin-top-1 govuk-!-margin-bottom-2">
                                        <strong>
                                            <a id="@("case-" + index)" class="govuk-link" asp-page="@currentCase.Title" data-cy="trust-name-@index" asp-route-id="@currentCase.TitleLink">@currentCase.Title</a>
                                        </strong>
                                    </div>
                                    <div class="govuk-hint">
                                        @currentCase.System
                                    </div>
                                    <div class="govuk-tag--yellow govuk-tag">
                                        @currentCase.ProjectType
                                    </div>
                                    @foreach (var caseItem in @currentCase.Info)
                                    {
                                        <div class="govuk-!-margin-top-1">
                                            <span id="@("case-item-" + index)"><strong>@caseItem.Label:</strong> @caseItem.Value</span>
                                        </div>
                                    }
                                </td>
                            </tr>

                        }
                    }
                }

            </tbody>
        </table>
        @if (Model.PageStatus.TotalResults > 0)
        {
            <partial name="Shared/_Pagination"/>
        }
    </div>
    
    <script asp-add-nonce>

        document.getElementById("sorting").addEventListener("change", onChange);

        function onChange(e)
        {
            document.getElementById("sortForm").submit()
        }
    </script>
</div>